"use strict";

var _createClass = function() {
    function e(i, t) {
        for (var n = 0; n < t.length; n++) {
            var e = t[n];
            e.enumerable = e.enumerable || !1, e.configurable = !0, "value" in e && (e.writable = !0), 
            Object.defineProperty(i, e.key, e);
        }
    }
    return function(i, t, n) {
        return t && e(i.prototype, t), n && e(i, n), i;
    };
}();

function _classCallCheck(i, t) {
    if (!(i instanceof t)) throw new TypeError("Cannot call a class as a function");
}

!function(i) {
    var t = !1, l = void 0, h = void 0, n = void 0, s = void 0, c = 300, r = 200, o = 42, a = 10, d = Math.PI, u = 62;
    function p(i, t) {
        return Math.round(Math.random() * (t - i) + i);
    }
    function e(i, t, n, e) {
        i.beginPath(), i.moveTo(n, e), i.lineTo(n + 21, e), i.arc(n + 21, e - a + 2, a, 0, 2 * d), 
        i.lineTo(n + 21, e), i.lineTo(n + o, e), i.lineTo(n + o, e + 21), i.arc(n + o + a - 2, e + 21, a, 0, 2 * d), 
        i.lineTo(n + o, e + 21), i.lineTo(n + o, e + o), i.lineTo(n, e + o), i.lineTo(n, e), 
        i.fillStyle = "#fff", i[t](), i.beginPath(), i.arc(n, e + 21, a, 1.5 * d, .5 * d), 
        i.globalCompositeOperation = "xor", i.fill();
    }
    var f = function() {
        function o(i) {
            var t = i.el, n = i.onSuccess, e = i.onError, s = i.onRefresh;
            _classCallCheck(this, o), this.el = t, this.onSuccess = n, this.onError = e, this.onRefresh = s;
        }
        return _createClass(o, [ {
            key: "init",
            value: function() {
                this.initDom(), this.updateStyle(), this.initImg(), this.draw(), this.bindEvents();
            }
        }, {
            key: "updateStyle",
            value: function() {
                $(".sliderContainer").css({
                    position: "relative",
                    textAlign: "center",
                    width: "300px",
                    height: "40px",
                    lineHeight: "40px",
                    " marginTop": "15px",
                    background: " #f7f9fa",
                    " color": " #45494c",
                    border: "1px solid #e4e7eb"
                }), $(".block").css({
                    position: "absolute",
                    left: "0",
                    top: "0"
                }), $(".slider").css({
                    position: "absolute",
                    top: " 0",
                    left: "0",
                    width: "40px",
                    height: "40px",
                    background: " #fff",
                    "box-shadow": "0 0 3px rgba(0, 0, 0, 0.3)",
                    cursor: "pointer",
                    transition: " background .2s linear"
                }), $(".sliderMask").css({
                    position: "absolute",
                    left: "0",
                    top: "0",
                    height: "40px",
                    border: " 0 solid #1991FA",
                    background: " #D1E9FE"
                }), $(".sliderIcon").css({
                    position: "absolute",
                    top: "15px",
                    left: "13px",
                    width: "14px",
                    height: "12px",
                    background: "url(http://cstaticdun.126.net//2.6.3/images/icon_light.f13cff3.png) 0 -26px",
                    "background - size": "34px 471px"
                }), $(".refreshIcon").css({
                    position: "absolute",
                    right: "10px",
                    top: "0",
                    width: "34px",
                    height: "34px",
                    cursor: "pointer",
                    background: "url(http://cstaticdun.126.net//2.6.3/images/icon_light.f13cff3.png) 0 -437px",
                    " background - size": "34px 471px"
                }), $(".container").css({
                    display: "inline-block",
                    position: "relative"
                });
            }
        }, {
            key: "initDom",
            value: function() {
                var i = $('<div class="container"></div>'), t = $('<canvas width="300" height="200"></canvas>'), n = $('<canvas width="300" height="200" class="block"></canvas>'), e = $('<div class="sliderContainer"></div>'), s = $('<div class="refreshIcon"></div>'), o = $('<div class="sliderMask"></div>'), c = $('<div class="slider"></div>'), r = $('<span class="sliderIcon"></span>'), a = $("<span>向右滑动滑块填充拼图</span>");
                this.el.append(i), $(".container").append(t), $(".container").append(n), $(".container").append(e), 
                $(".container").append(s), $(".sliderContainer").append(o), $(".sliderMask").append(c), 
                $(".slider").append(r), $(".sliderContainer").append(a), l = t[0].getContext("2d"), 
                h = n[0].getContext("2d"), this.canvasCtx = l, this.blockCtx = h, this.slider = c, 
                this.sliderContainer = e, this.block = n, this.canvas = t, this.refreshIcon = s, 
                this.sliderMask = o, this.sliderIcon = r;
            }
        }, {
            key: "initImg",
            value: function() {
                var i, t, n, e = this, s = (i = function() {
                    e.canvasCtx.drawImage(s, 0, 0, c, r), e.blockCtx.drawImage(s, 0, 0, c, r);
                    var i = e.y - 20 + 2, t = e.blockCtx.getImageData(e.x, i, u, u);
                    e.block[0].width = u, e.blockCtx.putImageData(t, 0, i);
                }, t = "http://picsum.photos/300/150?image=" + p(0, 1084), (n = document.createElement("img")).crossOrigin = "", 
                n.onload = i, n.onerror = function() {
                    n.src = t;
                }, n.src = t, n);
                this.img = s;
            }
        }, {
            key: "draw",
            value: function() {
                this.x = p(72, 228), this.y = p(30, 128), e(this.canvasCtx, "fill", this.x, this.y), 
                e(this.blockCtx, "clip", this.x, this.y), n = this.x;
            }
        }, {
            key: "bindEvents",
            value: function() {
                var i = this, n = !1, e = this;
                this.refreshIcon.click(function() {
                    i.reset(), "function" == typeof i.onRefresh && i.onRefresh();
                }), e.slider.on("mousedown", function(i) {
                    i.clientX, i.clientY, n = !0;
                }), e.slider.on("mouseup", function() {
                    n = !1, e.verify();
                }), $(document).on("mousemove", function(i) {
                    if (n) {
                        var t = i.clientX - 40;
                        i.clientY;
                        (s = t) < 0 || c < t + 62 || (e.slider.css({
                            left: t + "px"
                        }), e.block.css({
                            left: t + "px"
                        }), e.sliderMask.css({
                            width: t + "px"
                        }));
                    }
                }), $(document).on("mouseup", function(i) {
                    n && (n = !1, e.verify());
                });
            }
        }, {
            key: "verify",
            value: function() {
                var i = this;
                n - s < 10 && -10 < n - s ? (this.sliderIcon.css({
                    background: "url(http://cstaticdun.126.net//2.6.3/images/icon_light.f13cff3.png) 0 2px"
                }), this.slider.css({
                    background: "rgb(90, 232, 153)"
                }), this.sliderMask.css({
                    background: "rgb(189, 238, 211)"
                }), "function" == typeof this.onSuccess && this.onSuccess()) : (this.sliderIcon.css({
                    background: "url(http://cstaticdun.126.net//2.6.3/images/icon_light.f13cff3.png) 0 -82px"
                }), this.slider.css({
                    background: "red"
                }), this.sliderMask.css({
                    background: "#eeb0b0"
                }), t = !0, "function" == typeof this.onError && this.onError(t), setTimeout(function() {
                    i.reset(), i.sliderIcon.css({
                        background: "url(http://cstaticdun.126.net//2.6.3/images/icon_light.f13cff3.png) 0 -26px"
                    });
                }, 600));
            }
        }, {
            key: "reset",
            value: function() {
                this.slider.css({
                    left: "0",
                    background: "rgb(255, 255, 255)"
                }), this.block.css({
                    left: "0"
                }), this.sliderMask.css({
                    width: "0",
                    background: " #D1E9FE"
                }), this.clean(), this.img.src = "http://picsum.photos/300/150?image=" + p(0, 1084), 
                this.draw(), t = !1, "function" == typeof this.onError && this.onError(t);
            }
        }, {
            key: "clean",
            value: function() {
                this.canvasCtx.clearRect(0, 0, c, r), this.blockCtx.clearRect(0, 0, c, r), this.block[0].width = c;
            }
        } ]), o;
    }();
    i.verificationCode = {
        init: function(i) {
            return new f(i).init();
        }
    };
}(window);